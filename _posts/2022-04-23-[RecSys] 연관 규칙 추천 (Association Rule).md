---
title: "(작성중) [RecSys] 연관 규칙 추천 (Association Rule Mining)"
categories:
  - Recommender Systems
tags:
  - Business Cases
  - Recommender Systems
---

### 추천 시스템의 가장 원시적이지만 강력한 Baseline으로 사용되는 Association Rule에 대해 배워봅니다.  


> 기저귀를 샀던 김씨는 맥주도 사던데, 당신도 기저귀를 샀으니 맥주를 사는거 어때요?  


<center><img src="/assets/materials/recsys/inmobi_nfm/inmobi.jpg" align="center" alt="drawing" width="500"/></center>   


>  **1. ㅇ**
>
>  **2. ㅇ**
>
>  **3. ㅇ**

<br/>

----

#### Contents

<br/>

1.  [연관 규칙 추천이란?](#arm)
2.  [연관 규칙 추천의 로직](#logic)
3.  [코드 예제](#example)

<br />



<a id="arm"></a>

## 1. 연관 규칙 추천(Assocication Rule based Recommendation)이란?  
연관 규칙 추천이란, 어쩌면 이 글을 읽는 많은 분들이 데이터 마이닝, 혹은 빅데이터의 개론 강의에서 한 번쯤은 접해봤을 "기저귀와 맥주" 예시와 관련이 있습니다. 얼핏 어울리지 않는 "기저귀"와 "맥주"가 같이 자주 팔린다는 패턴을 활용해 추천을 한 일화, 혹시 들어 보셨나요? 장을 보러 온 부모님이 자신들이 마실 맥주를 구매하는 것이 매우 지당한 이야기 같지만, 데이터 없이 이러한 연관을 떠올린다는 것은 매우 힘든 일일 것입니다.  


이처럼 연관 규칙 추천의 접근법은, 얼른 말해 "A를 사면 B도 산다"는 규칙을 찾는 것인데요. 이를 찾아내는 방법은 전체 거래 내역을 살펴 보아, "A를 사는 사람은 B도 산다"라는 패턴에서 규칙을 찾아내는 것입니다. 정리하자면, **"A를 사는 사람은 B도 사던데, 당신은 A를 샀으니 B라는 상품은 어떠세요?"** 하며 추천하는 접근이죠.   


이처럼 다양한 item이 등장하는 전체 거래에서 **특정 item이 연결되는 방법, 그리고 그 이유를 결정하는 규칙을 발견**하기 위한 학습 방법론입니다. 이는 Market Basket Analysis, Affinity Analysis로도 알려져 있습니다.  


<a id="logic"></a>

## 2. 연관 규칙 추천의 로직

### 2-1. 데이터셋

데이터셋은 아래의 테이블처럼 장바구니 형태로 구성됩니다. 각각의 장바구니를 영수증으로 생각해도 됩니다. 이 때, 구매한 상품의 수량은 고려하지 않습니다. 햇반 10개를 사든, 1개를 사든 모두 동일하게 햇반입니다.  

**[장바구니 형태]**

| 장바구니 번호      | 구매 상품|
|-------------------------|:---------:|
| 1              |  햇반, 김치   |
| 2              |  햇반, 맥주, 땅콩  |
| 3              |  기저귀, 맥주, 김치   |
| 4              |  햇반, 김치, 기저귀, 맥주  |
| 5              |  햇반, 김치, 기저귀  |
| 6              |  김치, 맥주, 땅콩   |

<br>

아래의 형태 외에도, 각각의 상품을 하나의 칼럼으로 갖는 행렬의 형태로도 표현할 수 있습니다.


**[상품 행렬 형태]**

| 장바구니 번호      | 햇반 | 김치 | 맥주 | 기저귀 | 땅콩 |
|-------------------------|:---------:|:---------:|:---------:|:---------:|:---------:|
| 1              | 1 | 1 | 0 | 0 | 0 |
| 2              | 1 | 0 | 1 | 0 | 1 |
| 3              | 0 | 1 | 1 | 1 | 0 |
| 4              | 1 | 1 | 1 | 1 | 0 |
| 5              | 1 | 1 | 0 | 1 | 0 |
| 6              | 0 | 1 | 1 | 0 | 1 |



### 2-2. 용어 설명  

먼저, 연관 규칙 추천에서 사용되는 용어를 살펴보겠습니다. 앞서서, 연관 규칙 추천은 "A를 사는 사람은 B도 산다"라는 패턴을 찾아낸다고 했는데요. 이 서술을 둘로 쪼개어 보면, "A를 사면"과 "B도 산다"로 나누어볼 수 있겠습니다.  

이 앞부분에 해당하는 "A를 사면"은 **조건절(antecedent)** 이라고 하고, "B도 산다"를 **결과절(Consequent)** 이라고 합니다. 각각 "IF"와 "THEN"으로 연결지어 이해할 수도 있겠습니다. 또, **Item Set**이란 이 조건절과 결과절을 구성하는 상품의 집합을 나타냅니다. 여기서 조건절에 들어가 있는 상품과 결과절에 들어가 있는 상품은 상호 배반적(mutually exclusive, disjoint)이어야 합니다.   

- (햇반, 김치) -> (맥주, 땅콩) : 가능
- (*맥주*, 땅콩) -> (*맥주*, 기저귀) : 불가능


### 2-3. 연관 규칙 생성  

이제 이러한 규칙을 생성해 볼 차례입니다. 하나의 장바구니, 가령 "기저귀, 맥주, 김치"가 있을 때, 많은 규칙을 만들어낼 수 있을 것입니다.    

예를 들면,   
1) 만약 기저귀가 구매되면, 맥주도 같이 구매된다  
2) 만약 기저귀와 맥주가 구매되면, 김치도 같이 구매된다  
3) 만약 김치가 구매되면, 맥주도 같이 구매된다    
등이 가능하겠죠.  

이러한 경우의 수는 장바구니 내의 상품의 수에 따라 급속도로 증가하는데, 가령 6개의 아이템으로 구성된 인벤토리라 할지라도 수백개의 규칙이 가능해져버리게 됩니다. 이 때 불필요한(성능이 낮은) 규칙을 배제하기 위해, 다양한 성능 지표를 적용하여 연산 효율화할 수 있겠죠.  


### 2-4. 규칙 성능 지표  

#### 1) 지지도(Support)  

- Support(A->B)= P(A) or P(A,B)
- 기본적으로는 A라는 조건이 등장할 확률을 의미하지만(전자, P(A)), 대부분의 패키지에서는 후자로 구현함. (P(A,B))
- 빈번히 등장하는 아이템 집합을 찾기 위해 사용
- 지지도가 높을수록, 이 규칙을 적용할 가능성이 높아짐 (우리의 거래 내역에서 자주 등장하는 조합이니 자주 노출시킴)

#### 2) Confidence(신뢰도)
	- Confidence(A->B)= P(A,B)/P(A) = P(B|A)
	- A가 주어졌을 때 B의 조건부 확률을 나타냄
	- 유의미한 규칙을 만들어내기 위해 사용

#### 3) Lift(향상도)
	- lift(A->B)=P(A,B)/P(A)*P(B)
	- 생성된 규칙의 유용도를 나타내기 위해 사용
	- lift가 1이면 A와 B는 통계적으로 독립
	- lift > 1은 A와 B 사이에 긍정적인 관계
	- lift < 1은 A와 B 사이에 부정적인 관계
	- lift가 1.25라면, 라면과 밥이 독립이라고 가정했을 때에 비해서 0.25개가 더 팔렸다. 고로 그만큼 효과적인 규칙이다
	- confidence로 부족한 이유: 장바구니에 기본 아이템이 포함되어 있을 경우, 가령 노가리 호프집에서 맥주의 경우 맥주가 포함된 거래에서 모두 confidence는 높지만 lift는 낮을 것임


### 규칙 생성 알고리즘

  12. 규칙 생성 : Brute Force
  	- 이상적으로는 모든 조합을 고려해서 계산하는 것이 좋음
  	- 그러나 아이템 수가 늘어남에 따라 연산량에 기하급수적으로 증가
  	- 모든 규칙을 리스트업하고 각각 confidence, support를 계산
  	- 그 후 최소한의 threshold를 넘지 못하는 규칙을 제거
  	- 그러나 이는 연산적으로 불가능한 알고리즘임

  13. 규칙 생성 : A priori
  	- 오직 빈번하게 등장하는 아이템 셋에 대해서만 고려함
  	- support로 기준점을 잡음
  	1) 아이템 셋 빈도 P(A)의 기준
  	2) antecedent와 consequent 모두를 포함하고 있는 거래의 수(%)
  	- anti-monotone property: 한 아이템셋의 support는 그의 부분집합의 support를 넘지 못한다는 support의 특성. 달리 말해 minimum support를 넘지 못하는 아이템 조합의 superset은 모두 minimum support를 넘지 못함
  	- 고로 아이템 2개짜리 조합을 고려했을 때 minimum support를 넘지 못했다면, 다음 아이템 3개짜리 조합을 고려할 때 볼 필요도 없어짐
  	- 이와 같은 규칙을 적용함에 따라 연산량을 크게 줄일 수 있음

  14. 실제 사용 시 고려할 점
  	- support와 lift 둘 중에 하나를 골라야 될 경우 맥락에 따라 판단이 달라져야함
  	- support가 높으면 규칙을 적용할 가능성은 높지만, lift를 사용하면 효과는 확실함
  	- 즉 support는 노출의 가능성, lift는 전환의 성공 확률을 각각 중점으로 뒀을 때 더 가중치를 둬야할 성능지표임



<a id="example"></a>

## 3.







----------------


**개선을 위한 여러분의 피드백과 제안을 코멘트로 공유해 주세요.**
**내용에 대한 지적, 혹은 질문을 환영합니다.**  


**출처**  

https://www.youtube.com/watch?v=AUfYCH9KsoE
